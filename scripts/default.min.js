/*! roverbot - v1.0.0 - 2014-04-12 */
window.rover=window.rover||{},window.rover=function(){return{isNull:function(a){return"undefined"==typeof a||null===a||a.length<=0},getElement:function(a){var b,c=$(a);return c.length>0?b=c:console.log("DomException: Invalid or empty object "+a),b},getType:function(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}}}(window);
!function(a){var b={GetId:function(){return this.get(0).id},Get:function(a){return this.find(a)},Lookup:function(a){var b=this.find(a);return $(b).is("input")||$(b).is("select")||$(b).is("textarea")?b.val():b.html()},Reset:function(a){var b=$(this).SelCheck(a);return $(b).is("input")?b.val(""):b.html(""),this},Set:function(a,b){var c=this.find(a);return $(c).is("input")||$(c).is("select")?c.val(b):c.html(b),this},SelCheck:function(a){var b=this;return"undefined"!=typeof a&&(b=this.find(a)),b}};a.fn.extend(b)}(jQuery);
rover.handlebars=function(){"use strict";var a=function(a){var b=$(a).html();return b},b=function(b){var c=a(b),d=Handlebars.compile(c);return d};return{render:function(a,c){var d=b(a),e=d(c);return e},renderList:function(a,c){for(var d=b(a),e="",f=0;f<c.length;f++)e+=d(c[f]);return e}}}();
rover.reporting=function(){"using strict";var a=rover.getElement,b=rover.isNull,c=null,d=function(a){var b="S";return"0"===a?b="E":"90"===a?b="N":"180"===a&&(b="W"),b},e=function(a){if(!b(c)){var e=c.html(),f=a.Lookup(".coordinate").split("-"),g=a.Lookup(".direction");g=d(g),e+="<br />"+f[0]+" "+f[1]+" "+g,a.isLost&&(e+=" LOST"),c.html(e)}},f=function(){$(c).Reset()};return{init:function(b){c=a(b.reportingBoxId)},print:e,reset:f}}();
rover.bot=function(){"using strict";var a=rover.handlebars,b=rover.reporting,c=null,d=function(){return $("#planetMars .bot.active")},e=function(){var a=d();if(!(a.length<=0)){var b=a.Lookup(".coordinate"),c=b.split("-"),e=a.Lookup(".direction");return{bot:a,x:parseInt(c[0]),y:parseInt(c[1]),direction:parseInt(e)}}},f=function(b,e,f){h(d());var g={x:b,y:e,direction:f},i=a.render(c,g);$("#cell_"+b+"_"+e).prepend(i)},g=function(a){$(a).remove()},h=function(a){a.length>0&&(b.print(a),$(a).removeClass("active"))};return{init:function(a){c=a},get:e,add:f,remove:g}}();
rover.grid=function(){"using strict";var a=rover.getElement,b=rover.isNull,c=rover.handlebars,d=rover.bot,e=rover.reporting,f=null,g=null,h=null,i=null,j=null,k=null,l=0,m=0,n=function(a,b){var c=parseFloat(a/b),d=parseFloat(c/a),e=parseFloat(100*d);return e},o=function(a,b){a++,b++;var c=f.width(),d=f.height(),e=n(c,a),g=n(d,b),h=[],i=a*b-1;l=a,m=b;for(var j=0;b>j;j++)for(var k=a-1;k>=0;k--)h[i]={id:"cell",x:k,y:j,width:e,height:g},i--;p(h)},p=function(a){if(a.length>0){var b=c.renderList(g,a);f.html(b)}},q=function(a,b){return a>-1&&l>a&&b>-1&&m>b},r=function(a){var b=a.Lookup(".scent");return b&&b.length>0},s=function(a,b,c){a.isLost=!0,e.print(a);var d=$("#cell_"+b+"_"+c);d.Set(".scent","LOST").addClass("rb-lost")},t=function(){d.init(h),rover.keyboard&&rover.keyboard.init(),rover.reporting&&rover.reporting.init({reportingBoxId:k}),rover.instruction&&rover.instruction.init({instructionBoxId:j,executeBtnId:i})};return{init:function(c){f=a(c.containerId),j=a(c.instructionBoxId),i=a(c.executeBtnId),k=a(c.reportingBoxId),g=c.cellTemplateId,h=c.botTemplateId;var d=c.x,e=c.y;b(f)||b(d)||b(e)||b(h)||b(g)||b(j)||b(i)||b(k)||(o(d,e),t())},draw:o,cellExist:q,isLostCell:r,setLostCell:s}}();
rover.direction=function(){"using strict";var a=rover.isNull,b=rover.bot,c=rover.grid,d=function(){var c=b.get();if(a(c)===!1){var d=c.direction;90===d?k(c):180===d?i(c):270===d?j(c):h(c)}},e=function(){var c=b.get();if(a(c)===!1){var d=c.direction;90===d?j(c):0===d?i(c):270===d?k(c):h(c)}},f=function(a,b,c){var d="rb-degree-",e=d+b,f=d+c;a.Get(".rb-head").removeClass(e).addClass(f),a.Set(".direction",c)},g=function(c){var d=c;return a(d)&&(d=b.get()),d},h=function(b){var c=g(b);a(c)||f(c.bot,c.direction,90)},i=function(b){var c=g(b);a(c)||f(c.bot,c.direction,270)},j=function(b){var c=g(b);a(c)||f(c.bot,c.direction,0)},k=function(b){var c=g(b);a(c)||f(c.bot,c.direction,180)},l=function(){var a=b.get();if("object"==typeof a){var c=a.direction;90===c?m(a,a.x,a.y+1):180===c?m(a,a.x-1,a.y):270===c?m(a,a.x,a.y-1):0===c&&m(a,a.x+1,a.y)}},m=function(a,d,e){if(c&&b){var f=$("#cell_"+d+"_"+e);if(f&&c.isLostCell(f))return;b.remove(a.bot),c.cellExist(d,e)===!1&&c.setLostCell(a.bot,a.x,a.y),b.add(d,e,a.direction)}};return{turnLeft:d,turnRight:e,moveForward:l,moveNorth:h,moveSouth:i,moveEast:j,moveWest:k}}();
rover.keyboard=function(){"using strict";var a=rover.direction,b=rover.bot;return{init:function(){$(window).bind("keypress",function(c){97===(c.keyCode||c.which)&&b.add(0,0,90),110===(c.keyCode||c.which)&&a.moveNorth(),115===(c.keyCode||c.which)&&a.moveSouth(),101===(c.keyCode||c.which)&&a.moveEast(),119===(c.keyCode||c.which)&&a.moveWest(),114===(c.keyCode||c.which)&&a.turnRight(),108===(c.keyCode||c.which)&&a.turnLeft(),102===(c.keyCode||c.which)&&a.moveForward()})}}}();
rover.instruction=function(){"using strict";var a=rover.getElement,b=rover.isNull,c=rover.direction,d=rover.reporting,e=rover.grid,f=rover.bot,g=function(a,b){var c=b.val(),e=h(c);if(e.length>0){d.reset(),i(e[0]);for(var f=1;f<e.length;f+=2)j(e[f]),l(e[f+1])}},h=function(a){for(var b=a.split("\n"),c=0;c<b.length;c++)b[c].length<=0&&(b.splice(c,1),c--);return b},i=function(a){var b=a.split(" "),c=b[0],d=b[1];(c>50||d>50)&&alert("Coordinates value can't exceed 50."),e.draw(c,d)},j=function(a){var b=a.split(" "),c=b[0],d=b[1],e=b[2];f.add(c,d,90),k(e)},k=function(a){a=a.toLowerCase(),"n"===a?c.moveNorth():"s"===a?c.moveSouth():"e"===a?c.moveEast():"w"===a&&c.moveWest()},l=function(a){if(a.length>100)return void alert("Instruction length should be less than 100");for(var b=0;b<a.length;b++){var d=a[b].toLowerCase();"f"===d?c.moveForward():"l"===d?c.turnLeft():"r"===d&&c.turnRight()}},m=function(a,b){a.on("click",function(){g(this,b)})};return{init:function(c){var d=a(c.executeBtnId),e=a(c.instructionBoxId);b(d)||b(e)||m(d,e)}}}();